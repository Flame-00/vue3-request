{
  "version": 3,
  "sources": ["../../../../../../node_modules/.pnpm/@flame00+vue3-async-handler@1.0.10_typescript@5.8.3/node_modules/@flame00/vue3-async-handler/dist/vue3-async-handler.es.js"],
  "sourcesContent": ["import { shallowRef as p, watch as we, onScopeDispose as he, version as pe, toValue as M } from \"vue\";\nconst C = /* @__PURE__ */ new Map(), Re = (n, { data: l, params: r, time: i }) => {\n  C.set(n, { data: l, params: r, time: i });\n}, U = (n) => {\n  if (n)\n    return C.get(n);\n  C.clear();\n}, X = (n) => {\n  C.delete(n);\n}, c = /* @__PURE__ */ new Map(), ye = (n, { data: l, params: r }) => {\n  c.has(n) && c.get(n)?.forEach((f) => f({ data: l, params: r, time: Date.now() }));\n}, Y = (n, l) => (c.has(n) || c.set(n, /* @__PURE__ */ new Set()), c.get(n)?.add(l), () => {\n  const r = c.get(n);\n  r?.delete(l), r?.size === 0 && c.delete(n);\n});\nfunction Ee(n, l) {\n  let r = null, i = null, f = 0, A = !0, D = !0, v = null, R = null;\n  const o = p(), I = p(!1), b = p(!1), d = p(!1), L = p(null), s = p([]), S = {\n    manual: !1,\n    defaultParams: [],\n    errorRetryCount: 0,\n    errorRetryInterval: 1e3 * Math.pow(2, f),\n    // 错误重试间隔 指数增长\n    refocusTimespan: 5e3,\n    // 重新聚焦时间\n    staleTime: (/* @__PURE__ */ new Date(0)).setMinutes(3),\n    // 3分钟\n    ...l\n  }, { onBefore: N, onSuccess: O, onError: W, manual: Z, defaultParams: x, refreshDeps: z, refreshDepsAction: B, pollingInterval: k, errorRetryCount: V, errorRetryInterval: ee, refreshOnWindowFocus: te, refocusTimespan: ne, cacheKey: a, staleTime: re } = S, H = (e) => e?.name === \"AbortError\" || e?.code === \"ERR_CANCELED\" || e?.name === \"CanceledError\", P = () => {\n    r && !r.signal.aborted && !b.value && (r.abort(), d.value = r.signal.aborted);\n  };\n  function K(e) {\n    I.value = e, b.value = !e;\n  }\n  const se = () => (r = new AbortController(), d.value = r.signal.aborted, {\n    signal: r.signal\n  }), y = () => {\n    F(...s.value);\n  }, ae = async () => {\n    await T(...s.value);\n  }, _ = () => {\n    i && window.clearInterval(i);\n  };\n  function $(e) {\n    return e === void 0 ? e : typeof e == \"number\" && !isNaN(e);\n  }\n  const le = () => {\n    const { is: e, value: t } = g(M(k));\n    e && (_(), i = window.setInterval(y, t));\n  }, j = (e) => new Promise((t) => setTimeout(t, e)), G = async () => {\n    const { is: e, value: t } = g(M(ee));\n    e && (await j(t), y());\n  }, oe = async () => {\n    const { is: e, value: t } = g(M(V), !0);\n    if (e)\n      if (t === -1)\n        await G();\n      else {\n        if (f++, f > t) {\n          f = 0;\n          return;\n        }\n        await G();\n      }\n  }, ue = () => {\n    A = !1;\n  }, q = (e) => {\n    K(H(e) && !d.value || !1), S.onFinally?.({\n      data: e,\n      params: s.value\n    }), v = null;\n  };\n  function ie() {\n    if (!a) return;\n    const e = U(a);\n    e && (o.value = e.data, s.value = e.params), R = Y(a, (t) => {\n      o.value = t.data, s.value = t.params;\n    });\n  }\n  const ce = () => {\n    if (!a) return {\n      // 没有设置缓存key\n      isReturnRequest: !1\n    };\n    const e = U(a);\n    return e ? Date.now() - e.time > re ? (X(a), {\n      isReturnRequest: !1,\n      cache: null\n    }) : {\n      isReturnRequest: !0,\n      cache: e\n    } : {\n      isReturnRequest: !1,\n      cache: null\n    };\n  };\n  ie();\n  const T = async (...e) => {\n    const { cache: t, isReturnRequest: de } = ce();\n    if (de && t) {\n      const { data: m, params: w } = t;\n      return N?.(w), o.value = m, w.value = w, O?.(m, w), q(m), m;\n    }\n    if (v)\n      return v;\n    J(), s.value = e.length ? e : x, P();\n    const { signal: me } = se();\n    return K(!0), le(), v = new Promise((m, w) => {\n      (async () => {\n        try {\n          N?.(s.value);\n          const h = await n(me)(...s.value);\n          if (o.value = h, O?.(h, s.value), m(h), q(h), a) {\n            const u = { data: o.value, params: s.value, time: Date.now() };\n            R?.(), R = Y(a, (Q) => {\n              o.value = Q.data, s.value = Q.params;\n            }), Re(a, u), ye(a, u);\n          }\n        } catch (h) {\n          const u = h;\n          L.value = H(u) && !d.value ? null : u, W?.(u, s.value), A ? oe() : A = !0, w(u), q(u);\n        }\n      })();\n    }), v;\n  }, F = (...e) => {\n    T(...e).catch((t) => {\n      W || console.error(t);\n    });\n  };\n  Z || F(...x), z && we(\n    z,\n    () => {\n      if (B)\n        return B();\n      y();\n    },\n    {\n      deep: !0\n    }\n  );\n  async function E() {\n    const { is: e, value: t } = g(ne);\n    e && window.document.visibilityState === \"visible\" && navigator.onLine && D && (y(), D = !1, await j(t), D = !0);\n  }\n  function fe() {\n    te && (window.addEventListener(\"focus\", E), window.document.addEventListener(\"visibilitychange\", E));\n  }\n  fe();\n  function g(e, t) {\n    return $(e) === void 0 ? {\n      is: !1,\n      value: 0\n    } : $(e) ? t && e === -1 ? {\n      is: !0,\n      value: -1\n    } : {\n      is: !0,\n      value: e === 0 || e && e < 0 ? 0 : e\n    } : (console.error(`${e} is not a number`), {\n      is: !1,\n      value: 0\n    });\n  }\n  function J() {\n    s.value = [], o.value = null, L.value = null, I.value = !1, b.value = !1, d.value = !1;\n  }\n  function ve() {\n    r = null, i = null, v = null, R = null, window.removeEventListener(\"focus\", E), window.document.removeEventListener(\"visibilitychange\", E);\n  }\n  return he(() => {\n    R?.(), P(), J(), ve();\n  }, pe.startsWith(\"3.5\") ? !0 : void 0), {\n    data: o,\n    params: s,\n    isLoading: I,\n    isFinished: b,\n    isAborted: d,\n    error: L,\n    abort: P,\n    run: F,\n    runAsync: T,\n    refresh: y,\n    refreshAsync: ae,\n    cancelPolling: _,\n    cancelErrorRetry: ue,\n    clearCache: X\n  };\n}\nexport {\n  Ee as useAsyncHandler\n};\n"],
  "mappings": "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",
  "names": []
}
