{
  "version": 3,
  "sources": ["../../../../../../node_modules/.pnpm/@flame00+vue3-async-handler_ec946a0be506c6d348a5cac9ae95d5c5/node_modules/@flame00/vue3-async-handler-hooks/dist/vue3-async-handler-hooks.es.js"],
  "sourcesContent": ["import { shallowRef as h, watch as me, onScopeDispose as we, version as he, toValue as T } from \"vue\";\nconst g = /* @__PURE__ */ new Map(), pe = (n, { data: o, params: r, time: i }) => {\n  g.set(n, { data: o, params: r, time: i });\n}, Q = (n) => {\n  if (n)\n    return g.get(n);\n  g.clear();\n}, U = (n) => {\n  g.delete(n);\n}, u = /* @__PURE__ */ new Map(), Re = (n, { data: o, params: r }) => {\n  u.has(n) && u.get(n)?.forEach((f) => f({ data: o, params: r, time: Date.now() }));\n}, X = (n, o) => (u.has(n) || u.set(n, /* @__PURE__ */ new Set()), u.get(n)?.add(o), () => {\n  const r = u.get(n);\n  r?.delete(o), r?.size === 0 && u.delete(n);\n});\nfunction be(n, o) {\n  let r = null, i = null, f = 0, C = !0, A = !0, v = null, p = null;\n  const c = h(), F = h(!1), D = h(!1), R = h(!1), M = h(null), s = h([]), S = {\n    manual: !1,\n    defaultParams: [],\n    errorRetryCount: 0,\n    errorRetryInterval: 1e3 * Math.pow(2, f),\n    // 错误重试间隔 指数增长\n    refocusTimespan: 5e3,\n    // 重新聚焦时间\n    staleTime: (/* @__PURE__ */ new Date(0)).setMinutes(3),\n    // 3分钟\n    ...o\n  }, { onBefore: N, onSuccess: O, onError: W, manual: Y, defaultParams: x, refreshDeps: z, refreshDepsAction: B, pollingInterval: Z, errorRetryCount: k, errorRetryInterval: V, refreshOnWindowFocus: ee, refocusTimespan: te, cacheKey: a, staleTime: ne } = S, H = (e) => e?.name === \"AbortError\" || e?.code === \"ERR_CANCELED\" || e?.name === \"CanceledError\", I = () => {\n    r && !r.signal.aborted && !D.value && (r.abort(), R.value = r.signal.aborted);\n  };\n  function K(e) {\n    F.value = e, D.value = !e;\n  }\n  const re = () => (r = new AbortController(), R.value = r.signal.aborted, {\n    signal: r.signal\n  }), y = () => {\n    q(...s.value);\n  }, se = async () => {\n    await P(...s.value);\n  }, _ = () => {\n    i && window.clearInterval(i);\n  };\n  function $(e) {\n    return e === void 0 ? e : typeof e == \"number\" && !isNaN(e);\n  }\n  const ae = () => {\n    const { is: e, value: t } = E(T(Z));\n    e && (_(), i = window.setInterval(y, t));\n  }, j = (e) => new Promise((t) => setTimeout(t, e)), G = async () => {\n    const { is: e, value: t } = E(T(V));\n    e && (await j(t), y());\n  }, oe = async () => {\n    const { is: e, value: t } = E(T(k), !0);\n    if (e)\n      if (t === -1)\n        await G();\n      else {\n        if (f++, f > t) {\n          f = 0;\n          return;\n        }\n        await G();\n      }\n  }, le = () => {\n    C = !1;\n  }, L = (e) => {\n    K(H(e) && !R.value || !1), S.onFinally?.({\n      data: e,\n      params: s.value\n    }), v = null;\n  };\n  function ie() {\n    if (!a) return;\n    const e = Q(a);\n    e && (c.value = e.data, s.value = e.params), p = X(a, (t) => {\n      c.value = t.data, s.value = t.params;\n    });\n  }\n  const ce = () => {\n    if (!a) return {\n      // 没有设置缓存key\n      isReturnRequest: !1\n    };\n    const e = Q(a);\n    return e ? Date.now() - e.time > ne ? (U(a), {\n      isReturnRequest: !1,\n      cache: null\n    }) : {\n      isReturnRequest: !0,\n      cache: e\n    } : {\n      isReturnRequest: !1,\n      cache: null\n    };\n  };\n  ie();\n  const P = async (...e) => {\n    const { cache: t, isReturnRequest: ve } = ce();\n    if (ve && t) {\n      const { data: d, params: m } = t;\n      return N?.(m), c.value = d, m.value = m, O?.(d, m), L(d), d;\n    }\n    if (v)\n      return v;\n    s.value = e.length ? e : x, I();\n    const { signal: de } = re();\n    return K(!0), ae(), v = new Promise((d, m) => {\n      (async () => {\n        try {\n          N?.(s.value);\n          const w = await n(de)(...s.value);\n          if (c.value = w, O?.(w, s.value), d(w), L(w), a) {\n            const l = { data: c.value, params: s.value, time: Date.now() };\n            p?.(), p = X(a, (J) => {\n              c.value = J.data, s.value = J.params;\n            }), pe(a, l), Re(a, l);\n          }\n        } catch (w) {\n          const l = w;\n          M.value = H(l) && !R.value ? null : l, W?.(l, s.value), C ? oe() : C = !0, m(l), L(l);\n        }\n      })();\n    }), v;\n  }, q = (...e) => {\n    P(...e).catch((t) => {\n      W || console.error(t);\n    });\n  };\n  Y || q(...x), z && me(\n    z,\n    () => {\n      if (B)\n        return B();\n      y();\n    },\n    {\n      deep: !0\n    }\n  );\n  async function b() {\n    const { is: e, value: t } = E(te);\n    e && window.document.visibilityState === \"visible\" && navigator.onLine && A && (y(), A = !1, await j(t), A = !0);\n  }\n  function ue() {\n    ee && (window.addEventListener(\"focus\", b), window.document.addEventListener(\"visibilitychange\", b));\n  }\n  ue();\n  function E(e, t) {\n    return $(e) === void 0 ? {\n      is: !1,\n      value: 0\n    } : $(e) ? t && e === -1 ? {\n      is: !0,\n      value: -1\n    } : {\n      is: !0,\n      value: e === 0 || e && e < 0 ? 0 : e\n    } : (console.error(`${e} is not a number`), {\n      is: !1,\n      value: 0\n    });\n  }\n  const fe = () => {\n    r = null, i = null, v = null, p = null, window.removeEventListener(\"focus\", b), window.document.removeEventListener(\"visibilitychange\", b);\n  };\n  return we(() => {\n    p?.(), I(), fe();\n  }, he.startsWith(\"3.5\") ? !0 : void 0), {\n    data: c,\n    params: s,\n    isLoading: F,\n    isFinished: D,\n    isAborted: R,\n    error: M,\n    abort: I,\n    run: q,\n    runAsync: P,\n    refresh: y,\n    refreshAsync: se,\n    cancelPolling: _,\n    cancelErrorRetry: le,\n    clearCache: U\n  };\n}\nexport {\n  be as useAsyncHandler\n};\n"],
  "mappings": "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",
  "names": []
}
